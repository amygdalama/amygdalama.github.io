<!DOCTYPE html>
<html lang="en">
<head>
        <title>Amy Hanlon - Projects</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="../theme/css/main.css" type="text/css" />
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
   

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie.css"/>
                <script src="../js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="../css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="..">Amy Hanlon </a></h1>
                <nav><ul>
                    <li><a href="..">Home</a></li>
                    <li><a href="../pages/about.html">About</a></li>
                    <li><a href="../pages/contact.html">Contact</a></li>
                    <li><a href="../pages/projects.html">Projects</a></li>
                    <li><a href="../pages/talks.html">Talks</a></li>
                </ul></nav>

        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="../watch-it-fail.html">Watch it fail</a></h1>
<footer class="post-info">
        <abbr class="published" title="2015-06-27T00:00:00">
                June 27 2015
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info --><p>A tenet of test-driven development is, because you're writing your test first, you <em>watch it fail</em>, and then you write code to make it pass.
Here are three examples of tests that pass even when they shouldn't. See if you can figure out why!</p>
<h3 id="1-willow">1. willow</h3>
<p>A colleague of mine found a bunch of tests in our test suite using <a href="https://docs.python.org/3/library/unittest.mock.html">mock</a> that were written like this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TestChangePrimaryEmail</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_change_primary_email_sends_email_notification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_test_user</span><span class="p">()</span>
        <span class="n">old_email</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span>
        <span class="n">new_email</span> <span class="o">=</span> <span class="s">&#39;test@example.com&#39;</span>

        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Emailer</span><span class="p">,</span> <span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_send</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">change_primary_email</span><span class="p">(</span><span class="n">new_email</span><span class="p">)</span>

        <span class="n">mock_send</span><span class="o">.</span><span class="n">assert_has_call</span><span class="p">(</span><span class="n">old_email</span><span class="p">)</span>
</pre></div>


<p>This test would pass even if <code>user.change_primary_email</code> never sends an email! Why?</p>
<h3 id="2-lying-cat">2. lying cat</h3>
<p>Let's say we wanted to test cancelling a user, where a user object could look like this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">is_cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span>

    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cancelled</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<p>And then our test looks like this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TestCancelUser</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_cancel_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_test_user</span><span class="p">()</span>

        <span class="n">user</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">is_cancelled</span><span class="p">)</span>
</pre></div>


<p>This test would pass even if the user wasn't cancelled! Why?</p>
<h3 id="3-cady">3. cady</h3>
<p>Just this week we found a great bug:</p>
<ul>
<li>some users have special "post to wordpress" email addresses saved in their contact books</li>
<li>users can send invites to join Venmo to all of the email addresses in their contact book (who aren't already Venmo users)</li>
</ul>
<p>The combination of these two things could cause us to post an invite to join Venmo to the user's Wordpress blog. Oops.</p>
<p>A colleague fixed this bug by blacklisting emails with a Wordpress domain in our invite emailer and wrote a test for it like this:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">TestDontEmailWordpress</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_inviting_contacts_skips_wordpress_emails</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_test_user</span><span class="p">()</span>
        <span class="n">user_to_invite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_another_test_user</span><span class="p">()</span>
        <span class="n">user_to_invite</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s">&#39;blacklisted@wordpress.com&#39;</span>
        <span class="n">user</span><span class="o">.</span><span class="n">add_to_contacts</span><span class="p">(</span><span class="n">user_to_invite</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="o">.</span><span class="n">object</span><span class="p">(</span><span class="n">Emailer</span><span class="p">,</span> <span class="s">&#39;send&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mock_send</span><span class="p">:</span>
            <span class="n">spam_contact_book_with_invites</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">mock_send</span><span class="o">.</span><span class="n">called</span><span class="p">)</span>
</pre></div>


<p>This test would pass even if Wordpress emails weren't blacklisted! Why?</p>
                    <p>    <!-- <p> -->
        tags: 
           <a href="../tag/testing.html">testing</a>
           <a href="../tag/puzzles.html">puzzles</a>
    <!-- </p> -->
    
</p>
<p>There are probably no <a href="../watch-it-fail.html#disqus_thread">comments</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1 class="page-title">Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../module-objects-are-global.html" rel="bookmark" title="Permalink to Module objects are global!">Module objects are global!</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-06-14T00:00:00">
                June 14 2015
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>One of my favorite kinds of bugs is when a test that seems entirely unrelated to a code change fails. I've trained myself to look for the common causes, usually having to deal with shared state due to a test missing a proper teardown. But this week, I had ...</p>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/python.html">python</a>
           <a href="../tag/import.html">import</a>
           <a href="../tag/debugging.html">debugging</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../module-objects-are-global.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../module-objects-are-global.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../scoffing.html" rel="bookmark" title="Permalink to Things you can do other than scoffing at someone">Things you can do other than scoffing at someone</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-05-16T00:00:00">
                May 16 2015
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>Things you can do other than scoffing at someone who says they use a technology you heard was horrible: </p>
<ul>
<li>ask them about it, maybe they know things you don't know</li>
<li>change the subject</li>
<li>say something nice, like "I like your hat"</li>
<li>don't do or say anything</li>
<li>excuse yourself ...</li></ul>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/.html"></a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../scoffing.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../scoffing.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../pycon-recording-investigating-python-wats.html" rel="bookmark" title="Permalink to PyCon Recording: Investigating Python Wats">PyCon Recording: Investigating Python Wats</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2015-04-18T00:00:00">
                April 18 2015
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>Many of us have experienced a "wat" in Python - some behavior that totally mystifies us. Here is my PyCon talk on Investigating Python Wats, where we uncover some surprising implementation details of CPython, some unexpected consequences of mutability, and details of scope and name resolution.</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/sH4XF6pKKmk" frameborder="0" allowfullscreen></iframe>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/speaking.html">speaking</a>
           <a href="../tag/pycon.html">pycon</a>
           <a href="../tag/python.html">python</a>
           <a href="../tag/wats.html">wats</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../pycon-recording-investigating-python-wats.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../pycon-recording-investigating-python-wats.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../alterconf.html" rel="bookmark" title="Permalink to AlterConf: A Conference to Emulate">AlterConf: A Conference to Emulate</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-10-05T00:00:00">
                October 05 2014
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>Yesterday I attended <a href="http://www.alterconf.com/">AlterConf</a>, a conference about diversity in the tech and gaming industries, hosted by <a href="http://www.ashedryden.com/">Ashe Dryden</a>.</p>
<p>The talks were enlightening, personal, and hopeful:</p>
<ul>
<li><a href="http://thebitchwhocodes.com/">Stacey Mulcahy</a> and <a href="https://twitter.com/cattsmall">Catt Small</a> on lessons they've learned running the <a href="http://codeliberation.org/">Code Liberation Foundation</a>, an organization that offers free game development workshops for women ...</li></ul>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/alterconf.html">alterconf</a>
           <a href="../tag/diversity.html">diversity</a>
           <a href="../tag/conferences.html">conferences</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../alterconf.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../alterconf.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../dissecting-the-reduce-function.html" rel="bookmark" title="Permalink to Dissecting the Reduce Function">Dissecting the Reduce Function</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-04-07T00:00:00">
                April 07 2014
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>Good morning, <a href="http://www.vice.com/columns/good-morning-sinners-with-warren-ellis">sinners</a>. Today we're going to figure out what the hell is going on inside a Python expression like:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">things</span><span class="p">,</span> <span class="p">[])</span>
</pre></div>


<p>(What <code>things</code> is doesn't matter too much, as long as it's an iterable. We'll look at a more specific ...</p>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/hacker-school.html">hacker school</a>
           <a href="../tag/python.html">python</a>
           <a href="../tag/functional-programming.html">functional programming</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../dissecting-the-reduce-function.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../dissecting-the-reduce-function.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../after-six-months-of-learning-the-python-i-can-finally-print-hello-world.html" rel="bookmark" title="Permalink to After Six Months of Learning The Python, I Can Finally Print "Hello World!"">After Six Months of Learning The Python, I Can Finally Print "Hello World!"</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-04-01T00:00:00">
                April 01 2014
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>I've been trying to learn how to write a function in the Python that prints two words, only two, "Hello World." I've been trying for six months. And today, friends, I've done it.</p>
<p>I've read so many places that you can make print statements in the ...</p>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/python.html">python</a>
           <a href="../tag/python-internals.html">python internals</a>
           <a href="../tag/hello-world.html">hello world</a>
           <a href="../tag/hacker-school.html">hacker school</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../after-six-months-of-learning-the-python-i-can-finally-print-hello-world.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../after-six-months-of-learning-the-python-i-can-finally-print-hello-world.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../a-love-affair-with-broken-things.html" rel="bookmark" title="Permalink to A Love Affair With Broken Things">A Love Affair With Broken Things</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-03-31T00:00:00">
                March 31 2014
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>I love broken things, unfinished things, breaking things, unfinishing things. Broken and unfinished things allow you to see the process in which they were created; their most intimate secrets are exposed.</p>
<h2 id="broken-statues">Broken Statues</h2>
<p>A week ago, inside <a href="http://www.metmuseum.org/en">The Metropolitan Museum of Art</a>, my love for broken things was realized. Just ...</p>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/learning.html">learning</a>
           <a href="../tag/hacker-school.html">hacker school</a>
           <a href="../tag/python.html">python</a>
           <a href="../tag/functional-programming.html">functional programming</a>
           <a href="../tag/map.html">map</a>
           <a href="../tag/lambda.html">lambda</a>
           <a href="../tag/python-internals.html">python internals</a>
           <a href="../tag/grammar.html">grammar</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../a-love-affair-with-broken-things.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../a-love-affair-with-broken-things.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../whats-the-deal-with-builtins-vs-builtin.html" rel="bookmark" title="Permalink to What's the deal with __builtins__ vs __builtin__">What's the deal with <code>__builtins__</code> vs <code>__builtin__</code></a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-03-23T00:00:00">
                March 23 2014
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>Seriously, what's the difference? When you first fire up the Python interpreter, <code>__builtins__</code> is in your namespace for free:</p>
<div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="go">[&#39;__builtins__&#39;, &#39;__name__&#39;, &#39;__doc__&#39;, &#39;__package__&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__builtins__</span>
<span class="go">&lt;module &#39;__builtin__&#39; (built-in)&gt;</span>
</pre></div>


<p>But it appears to be the <code>__builtin__</code> module (singular)! If you:</p>
<div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">__builtin__</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">__builtin__</span> <span class="ow">is</span> <span class="n">__builtins__</span>
<span class="bp">True</span>
</pre></div>


<p>Hrm. So they ...</p>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/python.html">python</a>
           <a href="../tag/builtins.html">builtins</a>
           <a href="../tag/hacker-school.html">hacker school</a>
           <a href="../tag/python-internals.html">python internals</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../whats-the-deal-with-builtins-vs-builtin.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../whats-the-deal-with-builtins-vs-builtin.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                        <h1 class="entry-title"><a href="../import-accio-bootstrapping-python-grammar.html" rel="bookmark" title="Permalink to Replacing import with accio: A Dive into Bootstrapping and Python's Grammar">Replacing <code>import</code> with <code>accio</code>: A Dive into Bootstrapping and Python's Grammar</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-03-14T00:00:00">
                March 14 2014
        </abbr>

<p><!-- In <a href="../category/projects.html">Projects</a>  --></p>


</footer><!-- /.post-info -->                <div class="entry-summary">
                    <p>At <a href="https://www.hackerschool.com/">Hacker School</a>, I've been building an alternate universe Python by overwriting builtin functions and statements with Harry Potter spells. This is a thing you can do at Hacker School!</p>
<p>Although this project started as a joke, I've quickly descended so deeply into Python internals that I've ...</p>
                </div>
                <p class='summary-tags'>
    <!-- <p> -->
        tags: 
           <a href="../tag/python.html">python</a>
           <a href="../tag/harry-potter.html">harry potter</a>
           <a href="../tag/bootstrapping.html">bootstrapping</a>
           <a href="../tag/cpython.html">cpython</a>
           <a href="../tag/compilers.html">compilers</a>
           <a href="../tag/grammar.html">grammar</a>
           <a href="../tag/hacker-school.html">hacker school</a>
           <a href="../tag/python-internals.html">python internals</a>
    <!-- </p> -->
    
                </p>

                <p>
                <!-- <a class="readmore" href="../import-accio-bootstrapping-python-grammar.html">read more</a> -->
            </p>
                <!-- <p>There are probably no <a href="../import-accio-bootstrapping-python-grammar.html#disqus_thread">comments</a>.</p> -->
                </div><!-- /.entry-content -->
            </article></li>
<p class="paginator">
    Page 1 / 2
        <a href="../category/projects2.html">&raquo;</a>
</p>
            </ol><!-- /#posts-list -->
            </section><!-- /#content -->
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">

        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-48330831-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
<script type="text/javascript">
    var disqus_shortname = 'mathamy';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>